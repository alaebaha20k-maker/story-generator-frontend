<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Story Generator Ultimate - Professional Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800;900&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #667eea;
            --primary-dark: #5568d3;
            --secondary: #764ba2;
            --accent: #f093fb;
            --success: #10b981;
            --error: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
            --dark: #1e293b;
            --light: #f8fafc;
            --glass: rgba(255, 255, 255, 0.1);
            --shadow: 0 20px 60px rgba(0,0,0,0.3);
            --shadow-sm: 0 5px 15px rgba(0,0,0,0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            background-attachment: fixed;
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        /* Animated background particles */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(255,255,255,0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(255,255,255,0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(255,255,255,0.05) 0%, transparent 50%);
            animation: particleMove 20s ease-in-out infinite;
            pointer-events: none;
            z-index: 0;
        }

        @keyframes particleMove {
            0%, 100% { transform: translate(0, 0) scale(1); }
            33% { transform: translate(50px, -50px) scale(1.1); }
            66% { transform: translate(-50px, 50px) scale(0.9); }
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        /* Header with advanced animations */
        .header {
            text-align: center;
            color: white;
            margin-bottom: 60px;
            padding: 60px 0;
            animation: fadeInDown 1s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .header h1 {
            font-family: 'Playfair Display', serif;
            font-size: 4.5em;
            margin-bottom: 20px;
            font-weight: 900;
            background: linear-gradient(135deg, #fff 0%, #f0f0f0 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 5px 15px rgba(0,0,0,0.2);
            letter-spacing: -2px;
            position: relative;
            display: inline-block;
        }

        .header h1::after {
            content: '✨';
            position: absolute;
            top: -20px;
            right: -40px;
            font-size: 0.5em;
            animation: sparkle 2s ease-in-out infinite;
        }

        @keyframes sparkle {
            0%, 100% { transform: scale(1) rotate(0deg); opacity: 1; }
            50% { transform: scale(1.2) rotate(180deg); opacity: 0.8; }
        }

        .header p {
            font-size: 1.4em;
            opacity: 0.95;
            font-weight: 300;
            letter-spacing: 0.5px;
        }

        .header .badge {
            display: inline-block;
            margin-top: 15px;
            padding: 8px 20px;
            background: rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
            border-radius: 30px;
            font-size: 0.9em;
            font-weight: 600;
            border: 1px solid rgba(255,255,255,0.3);
        }

        /* Glass morphism card */
        .card {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 30px;
            padding: 50px;
            margin-bottom: 40px;
            box-shadow: var(--shadow);
            animation: fadeInUp 1s cubic-bezier(0.16, 1, 0.3, 1);
            border: 1px solid rgba(255,255,255,0.5);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 50%, var(--accent) 100%);
            animation: shimmer 3s linear infinite;
            background-size: 200% 100%;
        }

        /* Mode selector with smooth transitions */
        .mode-selector {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 25px;
            margin-bottom: 50px;
        }

        .mode-btn {
            padding: 35px;
            border: 3px solid #e5e7eb;
            border-radius: 20px;
            background: linear-gradient(135deg, #ffffff 0%, #f9fafb 100%);
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .mode-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
            z-index: 0;
            opacity: 0;
        }

        .mode-btn:hover::before {
            width: 400px;
            height: 400px;
            opacity: 0.1;
        }

        .mode-btn:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(102, 126, 234, 0.3);
            border-color: var(--primary);
        }

        .mode-btn.active {
            border-color: var(--primary);
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            transform: scale(1.05);
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.4);
        }

        .mode-btn.active::before {
            display: none;
        }

        .mode-btn .icon {
            font-size: 3em;
            margin-bottom: 15px;
            display: block;
            animation: bounce 2s ease-in-out infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .mode-btn h3 {
            font-size: 1.8em;
            margin-bottom: 12px;
            font-weight: 700;
            position: relative;
            z-index: 1;
        }

        .mode-btn p {
            opacity: 0.9;
            font-size: 1em;
            line-height: 1.6;
            position: relative;
            z-index: 1;
        }

        /* Form sections with smooth transitions */
        .form-section {
            display: none;
            animation: fadeIn 0.6s ease-out;
        }

        .form-section.active {
            display: block;
        }

        .section-title {
            font-size: 2em;
            margin-bottom: 35px;
            color: var(--dark);
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .section-title::before {
            content: '';
            width: 5px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            border-radius: 10px;
        }

        /* Enhanced form groups */
        .form-group {
            margin-bottom: 30px;
            animation: slideInLeft 0.5s ease-out backwards;
        }

        .form-group:nth-child(2) { animation-delay: 0.1s; }
        .form-group:nth-child(3) { animation-delay: 0.2s; }
        .form-group:nth-child(4) { animation-delay: 0.3s; }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        label {
            display: block;
            font-weight: 700;
            margin-bottom: 12px;
            color: var(--dark);
            font-size: 1.05em;
            letter-spacing: 0.3px;
        }

        label .required {
            color: var(--error);
            margin-left: 5px;
        }

        /* Premium input fields */
        input[type="text"],
        textarea,
        select {
            width: 100%;
            padding: 18px 22px;
            border: 2px solid #e5e7eb;
            border-radius: 16px;
            font-size: 1.05em;
            transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            font-family: inherit;
            background: #ffffff;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        input[type="text"]:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1), 0 4px 12px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        textarea {
            min-height: 140px;
            resize: vertical;
            line-height: 1.7;
        }

        /* Grid layouts */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }

        /* Niche selection grid with hover effects */
        .niche-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 12px;
            margin-top: 15px;
            max-height: 400px;
            overflow-y: auto;
            padding: 10px;
            background: #f9fafb;
            border-radius: 16px;
        }

        .niche-grid::-webkit-scrollbar {
            width: 8px;
        }

        .niche-grid::-webkit-scrollbar-track {
            background: #e5e7eb;
            border-radius: 10px;
        }

        .niche-grid::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 10px;
        }

        .niche-option {
            padding: 16px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            background: white;
            font-weight: 600;
            font-size: 0.95em;
            position: relative;
            overflow: hidden;
        }

        .niche-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(102, 126, 234, 0.1), transparent);
            transition: left 0.5s;
        }

        .niche-option:hover::before {
            left: 100%;
        }

        .niche-option:hover {
            border-color: var(--primary);
            transform: scale(1.05) translateY(-3px);
            box-shadow: 0 8px 16px rgba(102, 126, 234, 0.2);
        }

        .niche-option.selected {
            border-color: var(--primary);
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            font-weight: 700;
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }

        /* Premium buttons */
        .btn {
            padding: 18px 40px;
            border: none;
            border-radius: 16px;
            font-size: 1.15em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            text-transform: uppercase;
            letter-spacing: 1.2px;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:active::before {
            width: 300px;
            height: 300px;
            transition: width 0s, height 0s;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            width: 100%;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-4px);
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:active:not(:disabled) {
            transform: translateY(-2px);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            background: #9ca3af;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #f9fafb 0%, #e5e7eb 100%);
            color: var(--dark);
            border: 2px solid #e5e7eb;
        }

        .btn-secondary:hover {
            background: linear-gradient(135deg, #e5e7eb 0%, #d1d5db 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }

        /* Preview cards with smooth animations */
        .preview-card {
            background: linear-gradient(135deg, #f9fafb 0%, #ffffff 100%);
            border: 2px solid #e5e7eb;
            border-radius: 20px;
            padding: 35px;
            margin: 35px 0;
            animation: scaleIn 0.5s cubic-bezier(0.16, 1, 0.3, 1);
            box-shadow: var(--shadow-sm);
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .preview-card h3 {
            color: var(--primary);
            margin-bottom: 25px;
            font-size: 1.6em;
            font-weight: 800;
        }

        .preview-item {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e5e7eb;
            transition: all 0.3s;
        }

        .preview-item:hover {
            transform: translateX(5px);
            padding-left: 10px;
            border-left: 3px solid var(--primary);
        }

        .preview-item:last-child {
            border-bottom: none;
        }

        .preview-label {
            font-weight: 700;
            color: #6b7280;
            font-size: 0.95em;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .preview-value {
            color: var(--dark);
            line-height: 1.8;
            font-size: 1.05em;
        }

        /* Progress container with advanced animations */
        .progress-container {
            margin: 40px 0;
            animation: fadeIn 0.5s;
        }

        .progress-bar {
            width: 100%;
            height: 50px;
            background: #f1f5f9;
            border-radius: 25px;
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 2px 8px rgba(0,0,0,0.1);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 50%, var(--accent) 100%);
            background-size: 200% 100%;
            transition: width 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 800;
            font-size: 1.1em;
            animation: shimmer 2s linear infinite;
            position: relative;
            overflow: hidden;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: progressShine 1.5s infinite;
        }

        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        @keyframes progressShine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .status-message {
            text-align: center;
            margin-top: 20px;
            color: #4b5563;
            font-weight: 700;
            font-size: 1.2em;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* Story display with beautiful typography */
        .streaming-display {
            background: linear-gradient(135deg, #ffffff 0%, #f9fafb 100%);
            border: 2px solid #e5e7eb;
            border-radius: 20px;
            padding: 45px;
            margin: 35px 0;
            max-height: 700px;
            overflow-y: auto;
            font-family: 'Georgia', 'Times New Roman', serif;
            line-height: 2;
            color: var(--dark);
            white-space: pre-wrap;
            font-size: 1.1em;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.05);
            animation: fadeIn 0.6s;
        }

        .streaming-display::-webkit-scrollbar {
            width: 12px;
        }

        .streaming-display::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 10px;
        }

        .streaming-display::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            border-radius: 10px;
        }

        .streaming-display::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--secondary) 100%);
        }

        /* Stats dashboard */
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 25px;
            margin: 35px 0;
            padding: 0;
        }

        .stat-item {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #f8fafc 0%, #e5e7eb 100%);
            border-radius: 20px;
            transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            box-shadow: var(--shadow-sm);
            border: 2px solid #e5e7eb;
        }

        .stat-item:hover {
            transform: translateY(-8px) scale(1.05);
            box-shadow: 0 15px 30px rgba(0,0,0,0.2);
            border-color: var(--primary);
        }

        .stat-value {
            font-size: 2.8em;
            font-weight: 900;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            font-family: 'Playfair Display', serif;
        }

        .stat-label {
            font-size: 1em;
            color: #6b7280;
            margin-top: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1.5px;
        }

        /* Action buttons container */
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin-top: 35px;
        }

        /* Alerts with smooth animations */
        .alert {
            padding: 25px 30px;
            border-radius: 16px;
            margin: 25px 0;
            animation: slideIn 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            box-shadow: var(--shadow-sm);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .alert::before {
            font-size: 1.5em;
        }

        .alert-error {
            background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
            color: #991b1b;
            border-left: 5px solid var(--error);
        }

        .alert-error::before {
            content: '⚠️';
        }

        .alert-success {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            color: #166534;
            border-left: 5px solid var(--success);
        }

        .alert-success::before {
            content: '✅';
        }

        .alert-info {
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            color: #1e40af;
            border-left: 5px solid var(--info);
        }

        .alert-info::before {
            content: '💡';
        }

        /* Loading spinner */
        .loading-spinner {
            display: inline-block;
            width: 28px;
            height: 28px;
            border: 4px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 0.8s linear infinite;
            margin-right: 12px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Utility classes */
        .hidden {
            display: none !important;
        }

        /* Responsive animations */
        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from {
                transform: translateX(-100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Responsive design */
        @media (max-width: 1024px) {
            .header h1 {
                font-size: 3.5em;
            }
            
            .card {
                padding: 35px;
            }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2.5em;
            }
            
            .card {
                padding: 25px;
                border-radius: 20px;
            }

            .mode-selector {
                grid-template-columns: 1fr;
            }

            .niche-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }

            .stats {
                grid-template-columns: 1fr;
            }

            .action-buttons {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>AI Story Generator</h1>
            <p>Professional-Grade AI Story Creation with Ultra-Detailed Prompts</p>
            <div class="badge">🚀 Powered by Gemini 2.0 Flash • 125K+ Characters</div>
        </div>

        <div class="card">
            <div class="mode-selector">
                <div class="mode-btn active" onclick="switchMode('quick')">
                    <span class="icon">⚡</span>
                    <h3>Quick Mode</h3>
                    <p>Just enter a title - AI creates the entire story plan automatically</p>
                </div>
                <div class="mode-btn" onclick="switchMode('custom')">
                    <span class="icon">🎨</span>
                    <h3>Custom Mode</h3>
                    <p>Full creative control over every story detail and parameter</p>
                </div>
            </div>

            <div id="alertContainer"></div>

            <!-- QUICK MODE -->
            <div id="quickMode" class="form-section active">
                <h2 class="section-title">Quick Story Generation</h2>
                
                <div class="form-group">
                    <label for="quickTitle">Story Title<span class="required">*</span></label>
                    <input type="text" id="quickTitle" placeholder="e.g., 'The Last Dragon', 'Cyberpunk Detective', 'Lost in Time'" required>
                </div>

                <div class="form-group">
                    <label for="quickLength">Target Story Length</label>
                    <select id="quickLength">
                        <option value="10000">📖 Short Story (10K chars - ~2 minutes)</option>
                        <option value="30000">📚 Medium Story (30K chars - ~4 minutes)</option>
                        <option value="60000" selected>📕 Long Story (60K chars - ~8 minutes)</option>
                        <option value="100000">📗 Epic Story (100K chars - ~12 minutes)</option>
                    </select>
                </div>

                <button class="btn btn-primary" onclick="autoGenerateDetails()">
                    <span class="loading-spinner hidden" id="quickLoadingSpinner"></span>
                    🤖 Auto-Generate Story Plan
                </button>

                <div id="previewSection" class="hidden">
                    <div class="preview-card">
                        <h3>📋 AI-Generated Story Plan</h3>
                        <div class="preview-item">
                            <div class="preview-label">Genre</div>
                            <div class="preview-value" id="previewNiche"></div>
                        </div>
                        <div class="preview-item">
                            <div class="preview-label">Tone</div>
                            <div class="preview-value" id="previewTone"></div>
                        </div>
                        <div class="preview-item">
                            <div class="preview-label">Plot Summary</div>
                            <div class="preview-value" id="previewPlot"></div>
                        </div>
                        <div class="preview-item">
                            <div class="preview-label">Writing Style Sample</div>
                            <div class="preview-value" id="previewStyle"></div>
                        </div>
                    </div>

                    <div class="action-buttons">
                        <button class="btn btn-primary" onclick="approveAndGenerate()">
                            ✅ Approve & Generate Story
                        </button>
                        <button class="btn btn-secondary" onclick="autoGenerateDetails()">
                            🔄 Regenerate Plan
                        </button>
                    </div>
                </div>
            </div>

            <!-- CUSTOM MODE -->
            <div id="customMode" class="form-section">
                <h2 class="section-title">Custom Story Configuration</h2>
                
                <div class="form-group">
                    <label for="customTitle">Story Title<span class="required">*</span></label>
                    <input type="text" id="customTitle" placeholder="Enter your unique story title" required>
                </div>

                <div class="form-group">
                    <label>Select Genre<span class="required">*</span></label>
                    <div class="niche-grid" id="nicheGrid"></div>
                </div>

                <div class="grid">
                    <div class="form-group">
                        <label for="customTone">Story Tone<span class="required">*</span></label>
                        <select id="customTone" required>
                            <option value="">Select tone...</option>
                            <option value="Dark and gritty">🌑 Dark and gritty</option>
                            <option value="Epic and heroic">⚔️ Epic and heroic</option>
                            <option value="Light and humorous">😄 Light and humorous</option>
                            <option value="Mysterious and suspenseful">🔍 Mysterious and suspenseful</option>
                            <option value="Romantic and emotional">💕 Romantic and emotional</option>
                            <option value="Action-packed and intense">💥 Action-packed and intense</option>
                            <option value="Philosophical and thoughtful">🤔 Philosophical and thoughtful</option>
                            <option value="Horrifying and tense">😱 Horrifying and tense</option>
                            <option value="Whimsical and magical">✨ Whimsical and magical</option>
                            <option value="Noir and cynical">🕵️ Noir and cynical</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="customLength">Target Length</label>
                        <select id="customLength">
                            <option value="10000">📖 Short (10K)</option>
                            <option value="30000">📚 Medium (30K)</option>
                            <option value="60000" selected>📕 Long (60K)</option>
                            <option value="100000">📗 Epic (100K)</option>
                            <option value="125000">📘 Ultra (125K+)</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="customPlot">Plot Summary<span class="required">*</span></label>
                    <textarea id="customPlot" placeholder="Describe your story plot in detail. Include main conflict, key characters, setting, and major plot points..." required></textarea>
                </div>

                <div class="form-group">
                    <label for="customStyle">Writing Style Example<span class="required">*</span> (min 500 characters)</label>
                    <textarea id="customStyle" placeholder="Paste a sample of writing that matches your desired style. This helps the AI understand the tone, pacing, and descriptive density you want..." style="min-height: 180px;" required></textarea>
                </div>

                <div class="form-group">
                    <label for="customExtra">Additional Instructions (optional)</label>
                    <textarea id="customExtra" placeholder="Any special requirements, themes, character details, or specific scenes you want included..."></textarea>
                </div>

                <button class="btn btn-primary" onclick="generateCustomStory()">
                    <span class="loading-spinner hidden" id="customLoadingSpinner"></span>
                    🚀 Generate Story
                </button>
            </div>

            <div id="progressContainer" class="progress-container hidden">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill">0%</div>
                </div>
                <div class="status-message" id="statusMessage">Initializing AI generation...</div>
            </div>
        </div>

        <div id="resultContainer" class="card hidden">
            <h2 class="section-title">✨ Your Generated Story</h2>
            
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-value" id="charCount">0</div>
                    <div class="stat-label">Characters</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="wordCount">0</div>
                    <div class="stat-label">Words</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="timeCount">0s</div>
                    <div class="stat-label">Time</div>
                </div>
            </div>

            <div class="streaming-display" id="storyDisplay"></div>

            <div class="action-buttons">
                <button class="btn btn-secondary" onclick="copyToClipboard()">📋 Copy Text</button>
                <button class="btn btn-secondary" onclick="downloadStory()">💾 Download .txt</button>
                <button class="btn btn-primary" onclick="resetAll()">🔄 Create New Story</button>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'https://story-generator-backend-bier.onrender.com';
        
        let currentMode = 'quick';
        let generatedDetails = null;
        let generatedStory = '';
        let selectedNiche = '';
        let startTime = 0;

        // 50+ Premium Niches
        const niches = [
            'Fantasy', 'Sci-Fi', 'Romance', 'Horror', 'Mystery', 'Thriller', 'Adventure',
            'Drama', 'Comedy', 'Historical Fiction', 'Urban Fantasy', 'Cyberpunk',
            'Dystopian', 'Superhero', 'Western', 'Post-Apocalyptic', 'Paranormal',
            'Crime', 'War', 'Slice of Life', 'Steampunk', 'Space Opera', 'Military',
            'Noir', 'Gothic', 'Supernatural', 'Time Travel', 'Alternate History',
            'Magical Realism', 'Young Adult', 'Epic Fantasy', 'Dark Fantasy',
            'High Fantasy', 'Sword and Sorcery', 'Zombie', 'Vampire', 'Werewolf',
            'Alien', 'Psychological', 'Action', 'Espionage', 'Heist', 'Sports',
            'Political', 'Legal', 'Medical', 'Detective', 'Cozy Mystery', 'Hard Boiled',
            'Revenge', 'Survival', 'Coming of Age'
        ];

        // Initialize niche grid
        function initNicheGrid() {
            const grid = document.getElementById('nicheGrid');
            niches.forEach(niche => {
                const div = document.createElement('div');
                div.className = 'niche-option';
                div.textContent = niche;
                div.onclick = () => selectNiche(niche, div);
                grid.appendChild(div);
            });
        }

        function selectNiche(niche, element) {
            document.querySelectorAll('.niche-option').forEach(el => el.classList.remove('selected'));
            element.classList.add('selected');
            selectedNiche = niche;
        }

        function switchMode(mode) {
            currentMode = mode;
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.form-section').forEach(sec => sec.classList.remove('active'));
            
            if (mode === 'quick') {
                document.querySelectorAll('.mode-btn')[0].classList.add('active');
                document.getElementById('quickMode').classList.add('active');
            } else {
                document.querySelectorAll('.mode-btn')[1].classList.add('active');
                document.getElementById('customMode').classList.add('active');
            }
            
            hideAlert();
        }

        async function autoGenerateDetails() {
            const title = document.getElementById('quickTitle').value.trim();
            
            if (!title) {
                showAlert('Please enter a story title first', 'error');
                return;
            }

            const btn = event.target;
            const spinner = document.getElementById('quickLoadingSpinner');
            btn.disabled = true;
            spinner.classList.remove('hidden');
            
            showAlert('🤖 AI is analyzing your title and crafting a complete story plan...', 'info');
            
            try {
                const response = await fetch(`${API_URL}/api/auto-generate-details`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ title })
                });

                const data = await response.json();

                if (!data.success) {
                    throw new Error(data.error || 'Auto-generation failed');
                }

                generatedDetails = data.details;
                
                // Display preview with smooth reveal
                document.getElementById('previewNiche').textContent = generatedDetails.niche;
                document.getElementById('previewTone').textContent = generatedDetails.tone;
                document.getElementById('previewPlot').textContent = JSON.stringify(generatedDetails.plot);
                document.getElementById('previewStyle').textContent = generatedDetails.styleExample;
                
                document.getElementById('previewSection').classList.remove('hidden');
                showAlert('✅ Story plan generated successfully! Review the details and click "Approve" to generate your story.', 'success');

            } catch (error) {
                showAlert('❌ ' + error.message, 'error');
            } finally {
                btn.disabled = false;
                spinner.classList.add('hidden');
            }
        }

        async function approveAndGenerate() {
            if (!generatedDetails) return;

            const title = document.getElementById('quickTitle').value;
            const targetLength = parseInt(document.getElementById('quickLength').value);

            await generateWithStreaming(
                title,
                generatedDetails.niche,
                generatedDetails.tone,
                JSON.stringify(generatedDetails.plot),
                generatedDetails.styleExample,
                '',
                targetLength
            );
        }

        async function generateCustomStory() {
            const title = document.getElementById('customTitle').value.trim();
            const tone = document.getElementById('customTone').value;
            const plot = document.getElementById('customPlot').value.trim();
            const style = document.getElementById('customStyle').value.trim();
            const extra = document.getElementById('customExtra').value.trim();
            const targetLength = parseInt(document.getElementById('customLength').value);

            if (!title || !selectedNiche || !tone || !plot || !style) {
                showAlert('❌ Please fill all required fields (marked with *)', 'error');
                return;
            }

            if (style.length < 500) {
                showAlert('❌ Writing style example must be at least 500 characters', 'error');
                return;
            }

            await generateWithStreaming(title, selectedNiche, tone, plot, style, extra, targetLength);
        }

        async function generateWithStreaming(title, niche, tone, plot, styleExample, extraInstructions, targetLength) {
            hideAlert();
            document.getElementById('progressContainer').classList.remove('hidden');
            document.getElementById('resultContainer').classList.add('hidden');
            
            const storyDisplay = document.getElementById('storyDisplay');
            storyDisplay.textContent = '';
            generatedStory = '';
            startTime = Date.now();

            try {
                const response = await fetch(`${API_URL}/api/generate-stream`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        title, niche, tone, plot, styleExample, extraInstructions, targetLength
                    })
                });

                const reader = response.body.getReader();
                const decoder = new TextDecoder();

                while (true) {
                    const { value, done } = await reader.read();
                    if (done) break;

                    const chunk = decoder.decode(value);
                    const lines = chunk.split('\n');

                    for (const line of lines) {
                        if (line.startsWith('data: ')) {
                            const data = JSON.parse(line.slice(6));

                            if (data.type === 'init') {
                                updateProgress(0, `Generating ${data.totalChunks} parts...`);
                            } else if (data.type === 'progress') {
                                updateProgress(data.progress, `✍️ Writing part ${data.chunk}/${data.total}...`);
                            } else if (data.type === 'chunk') {
                                generatedStory += data.text + '\n\n';
                                storyDisplay.textContent = generatedStory;
                                document.getElementById('resultContainer').classList.remove('hidden');
                                storyDisplay.scrollTop = storyDisplay.scrollHeight;
                            } else if (data.type === 'complete') {
                                const elapsed = Math.round((Date.now() - startTime) / 1000);
                                document.getElementById('charCount').textContent = data.totalChars.toLocaleString();
                                document.getElementById('wordCount').textContent = data.totalWords.toLocaleString();
                                document.getElementById('timeCount').textContent = elapsed + 's';
                                updateProgress(100, '🎉 Story complete!');
                                setTimeout(() => {
                                    document.getElementById('progressContainer').classList.add('hidden');
                                }, 2000);
                                showAlert('✅ Your story has been generated successfully!', 'success');
                            } else if (data.type === 'error') {
                                throw new Error(data.error);
                            }
                        }
                    }
                }

            } catch (error) {
                showAlert('❌ ' + error.message, 'error');
                document.getElementById('progressContainer').classList.add('hidden');
            }
        }

        function updateProgress(percent, message) {
            document.getElementById('progressFill').style.width = percent + '%';
            document.getElementById('progressFill').textContent = percent + '%';
            document.getElementById('statusMessage').textContent = message;
        }

        function showAlert(message, type) {
            const container = document.getElementById('alertContainer');
            container.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
            setTimeout(() => {
                container.querySelector('.alert').style.animation = 'fadeIn 0.4s reverse';
            }, 5000);
        }

        function hideAlert() {
            document.getElementById('alertContainer').innerHTML = '';
        }

        function copyToClipboard() {
            navigator.clipboard.writeText(generatedStory).then(() => {
                showAlert('✅ Story copied to clipboard!', 'success');
            });
        }

        function downloadStory() {
            const title = document.getElementById(currentMode === 'quick' ? 'quickTitle' : 'customTitle').value || 'story';
            const blob = new Blob([generatedStory], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${title.replace(/[^a-z0-9]/gi, '_').toLowerCase()}.txt`;
            a.click();
            URL.revokeObjectURL(url);
            showAlert('✅ Story downloaded successfully!', 'success');
        }

        function resetAll() {
            document.getElementById('quickTitle').value = '';
            document.getElementById('customTitle').value = '';
            document.getElementById('customPlot').value = '';
            document.getElementById('customStyle').value = '';
            document.getElementById('customExtra').value = '';
            document.getElementById('previewSection').classList.add('hidden');
            document.getElementById('resultContainer').classList.add('hidden');
            generatedDetails = null;
            generatedStory = '';
            selectedNiche = '';
            document.querySelectorAll('.niche-option').forEach(el => el.classList.remove('selected'));
            hideAlert();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Initialize on load
        initNicheGrid();
    </script>
</body>
</html>
